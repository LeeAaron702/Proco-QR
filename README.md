# Professor Color Customer Service QR System
The Professor Color Customer Service QR System is a streamlined solution designed to minimize the steps, clicks, and friction associated with product replacement across all of Professor Color's sales channels, including Shopify, Amazon and Walmart.com. Professor Color has and expanding product line, currently at 125 products, each with a dedicated QR code linked to their product details, reducing time spent on product identification and replacement. This document explains the QR System's functionality, how it works, and provides examples of its use.

Background
In an effort to simplify and accelerate the product replacement process, QR codes were generated for each of the 125 products in the Professor Color catalog. These QR codes, each uniquely linked to a specific product, are affixed to both the product's box and the product itself. This strategy removes the need for manual product identification, significantly expediting the replacement process. This also allows for a streamlined way to add more products to this system by simplying creating a QR code one time. Importantly, the data needed for the client-facing React component is carried within the URL as JSON data. This approach improves load times, removing the need for querying the Shopify API each time a product needs replacement.


## QR Code Generator (QRCodeGenerator.js)
The QR Code Generator form enables the user to input the Shopify product ID and the Amazon ASIN. The rest is populated automatically via Shopify's API. Fields include Shopify product ID, Variant ID, Product Title, Shopify link, Model number, and Amazon ASIN.

Fields for this are: 
- Shopify product ID
    - This is inputted by the user.
- Variant ID
    - Autogenerated by Shopify API
- Product Title
    - Autogenerated by Shopify API
- Shopify link
    - This link is created with data from the Shopify API.
- Model number
    - This is parsed out of the product title that is called from the Shopify API with the product ID.
- Amazon ASIN
    - This is inputted by the user.
---
- A button to search for product details using the product ID.
- A submit button that generates a QR code from the inputted information.
- A button to download the QR code as a PNG image.
    - This saved the QR code with the SKU, ID, and VariantId
- A button to clear all the fields.

The generated QR code links to a URL that contains a JSON object with the product information. This object can be used to display detailed product information when the QR code is scanned.

### Serverless API Handler (/api/fetch-product-details)
This is a serverless function that interacts with Shopify's API. It fetches the product details (variant ID, product title, handle, model number, and product image) using the product ID. These details are then sent back to the client-side and are used to populate the form fields in the QR Code Generator.

## Product Page (ProductPage.js)
The Product Page file contains a React component, 'InstantReplacementModal.' This component manages an "Instant Replacement" form in a modal dialog. When the form is submitted, a POST request is sent to the /api/InstantReplacement endpoint on the server.

The user is expected to fill in their personal and address details, and submit the form. Once the form is submitted, a POST request is sent to the /api/InstantReplacement endpoint on the server with all the form details.

An important feature of this form is the address autocomplete functionality. As users start typing their address, the component fetches address predictions from the /api/autocomplete endpoint.

### Instant Replacement Modal
The InstantReplacementModal component uses React's Hook APIs for local state management and effect handling. It contains the following main functionalities:

- Form Submission: The form submission is handled by the handleSubmit function, which calls instantReplacement function. This sends the form data to the server using the fetch API.

- Form Validation: The form includes validations such as ensuring phone numbers are numbers up to 10 digits, and zip codes are numbers up to 5 digits.

- Address Autocomplete: The address input field has an autocomplete functionality which fetches suggestions as the user types. This is handled by the debouncedAutoComplete function, which calls the /api/autocomplete endpoint.

- Error and Success Messages: Depending on the server response, appropriate error or success messages are displayed to the user. 

- Error Handling: All errors are relayed to a slack channel that is monitored by the Developer and Customer Support Team.

- Form Clear: On form submission or when the modal is closed, the form fields are cleared.

### How it Works
The InstantReplacementModal component uses React's Hook APIs for local state management and effect handling. It contains the following main functionalities:

- Form Submission: The form submission is handled by the handleSubmit function, which calls instantReplacement function. This sends the form data to the server using the fetch API.

- Form Validation: The form includes validations such as ensuring phone numbers are numbers up to 10 digits, and zip codes are numbers up to 5 digits.

- Address Autocomplete: The address input field has an autocomplete functionality which fetches suggestions as the user types. This is handled by the debouncedAutoComplete function, which calls the /api/autocomplete endpoint.

- Error and Success Messages: Depending on the server response, appropriate error or success messages are displayed to the user. 

- Error Handling: All errors are relayed to a slack channel that is monitored by the Developer and Customer Support Team.

- Form Clear: On form submission or when the modal is closed, the form fields are cleared.

### Serverless Function for Customer and Order Creation
The function handler is a serverless function designed to handle POST requests for creating or updating customer records and creating replacement orders in Shopify. It first validates the request method and then processes the customer and order data, notifying any errors to a Slack channel. 

### Main handler function
The handler function is designed to handle HTTP requests. If the HTTP method of the request is not POST, it sends a 405 'Method not allowed' response. It then processes the request, creating or updating the customer data and creating a new order. In case of any errors, it sends the error message to a Slack channel and responds with a 500 status code and the error message.

### Customer Data Extraction
The extractCustomerData function extracts customer data from the request body and formats it for the Shopify API. The function expects the request body to contain fields for the first name, last name, phone, email, and address of the customer.

### Create or Update Customer
The createOrUpdateCustomer function sends a POST request to the Shopify API to create a new customer. If the provided email or phone number is already associated with a customer, the function calls the handleCustomerErrors function to find and return the existing customer.

### Handle Customer Errors
The handleCustomerErrors function checks if the error is due to an already existing email or phone number. If so, it calls the appropriate function to find the existing customer by the email or phone number. If the error is not due to an already existing email or phone number, it throws an error.

### Find Existing Customer By Email/Phone
The findExistingCustomerByEmail and findExistingCustomerByPhone functions send a GET request to the Shopify API to search for an existing customer by the provided email or phone number. If a customer is found, it is returned, otherwise, an error is thrown.

### Check for Recent Replacement Orders
The checkForRecentReplacementOrders function sends a GET request to the Shopify API to retrieve orders from the past 24 hours. It then checks if any of these orders match the customer ID or the shipping address. If a match is found, an error is thrown.

### Extract Order Data
The extractOrderData function extracts order data from the request body and the customer object, and formats it for the Shopify API. The function expects the request body to contain fields for the first name, last name, phone, address, and variant ID of the product.

### Create Order
The createOrder function sends a POST request to the Shopify API to create a new order with the provided data. If the request fails, it throws an error.

### Notify Error To Slack
The notifyErrorToSlack function sends a POST request to a Slack webhook URL to notify of any error. It includes the error message and customer details in the Slack message for a customer service agent to contact the customer in a timely manner.

# Accounts Used
## Personal Accounts 
- Version Control Through Github
- Deployment through Vercel.com

## Sales@professorcolor.com
- Cloudflare.com
    - proco-qr.com
    - Domain purchased with buyin paypal

## Lee@professorcolor.com
- Google Maps API
    - Address Autocomplete